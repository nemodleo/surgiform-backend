# .env íŒŒì¼ì—ì„œ í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
include .env
export

# bashë¥¼ ê¸°ë³¸ ì‰˜ë¡œ ì„¤ì •
SHELL := /bin/bash

install:
	poetry install

install-playwright-browser:
	poetry run playwright install chromium

dev:
	poetry run uvicorn surgiform.deploy.server:app \
		--reload \
		--port 8000 \
		--host 0.0.0.0

deploy-ssl:
	# sudo apt update
	# sudo apt install certbot -y
	sudo certbot certonly --standalone -d api.surgi-form.com

deploy:
	@UVICORN_PATH=$$(poetry run which uvicorn) && \
	sudo $$UVICORN_PATH surgiform.deploy.server:app \
	  --host 0.0.0.0 \
	  --port 443 \
	  --ssl-keyfile /etc/letsencrypt/live/api.surgi-form.com/privkey.pem \
	  --ssl-certfile /etc/letsencrypt/live/api.surgi-form.com/fullchain.pem \
	  > >(sudo tee /var/log/surgiform_https.log) 2>&1 &

lint:
	poetry run flake8 . \
	&& poetry run mypy .

test:
	poetry run pytest -q

test-health:
	curl -X GET http://localhost:8000/health


test-chat-session:
	echo '\
{ \
  "system_prompt": "ë‹¹ì‹ ì€ ìˆ˜ìˆ  ë™ì˜ì„œ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤. í™˜ìžê°€ ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”." \
}' | \
	curl -X POST http://localhost:8000/chat/session \
	     -H "Content-Type: application/json" \
	     -d @- | jq '.'

test-chat:
	echo '\
{ \
  "message": "ì•ˆë…•í•˜ì„¸ìš”! ìˆ˜ìˆ  ë™ì˜ì„œì— ëŒ€í•´ ê¶ê¸ˆí•œ ê²ƒì´ ìžˆì–´ìš”." \
}' | \
	curl -X POST http://localhost:8000/chat \
	     -H "Content-Type: application/json" \
	     -d @-

test-chat-with-session:
	echo '\
{ \
  "message": "ì´ ìˆ˜ìˆ ì˜ ìœ„í—˜ì„±ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.", \
  "conversation_id": "$(CHAT_ID)" \
}' | \
	curl -X POST http://localhost:8000/chat \
	     -H "Content-Type: application/json" \
	     -d @-

# ë™ì˜ì„œ ë°ì´í„°ì™€ í•¨ê»˜ ì§ˆë¬¸í•˜ê¸°
test-chat-with-consent-question:
	echo '\
{ \
  "message": "ì´ ìˆ˜ìˆ ì˜ í•©ë³‘ì¦ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.", \
  "conversation_id": "$(CHAT_ID)", \
  "consents": { \
    "prognosis_without_surgery": "ë‹´ë‚­ê²°ì„ì— ëŒ€í•´ ìˆ˜ìˆ ì„ ì‹œí–‰í•˜ì§€ ì•Šì„ ê²½ìš°, ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì´ ë°œìƒí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
    "alternative_treatments": "ë‹´ë‚­ê²°ì„ ì¹˜ë£Œë¥¼ ìœ„í•œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” ì²´ì™¸ì¶©ê²©íŒŒì‡„ì„ìˆ (ESWL), ê²½êµ¬ ë‹´ì„ìš©í•´ì œ ë³µìš©, ê²½í”¼ì  ë‹´ë‚­ë°°ì•¡ìˆ  ë“±ì´ ìžˆìœ¼ë‚˜, ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ íš¨ê³¼ê°€ ì œí•œì ì´ê³  ìž¬ë°œë¥ ì´ ë†’ì•„ ê·¼ë³¸ì ì¸ ì¹˜ë£Œë²•ì¸ ìˆ˜ìˆ ì  ì¹˜ë£Œê°€ ê°€ìž¥ íš¨ê³¼ì ì¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìžˆìŠµë‹ˆë‹¤.", \
    "surgery_purpose_necessity_effect": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì˜ ëª©ì ì€ ë‹´ë‚­ê²°ì„ìœ¼ë¡œ ì¸í•œ ì—¼ì¦ê³¼ í†µì¦ì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤.", \
    "surgery_method_content": { \
      "overall_description": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ë°°ì— ìž‘ì€ êµ¬ë©ì„ ëš«ì–´ ì¹´ë©”ë¼ì™€ ìˆ˜ìˆ ê¸°êµ¬ë¥¼ ë„£ì–´ ë‹´ë‚­ì„ ì œê±°í•˜ëŠ” ìµœì†Œì¹¨ìŠµ ìˆ˜ìˆ ìž…ë‹ˆë‹¤.", \
      "estimated_duration": "ìˆ˜ìˆ  ì‹œê°„ì€ ì¼ë°˜ì ìœ¼ë¡œ 1-2ì‹œê°„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤.", \
      "method_change_or_addition": "ìˆ˜ìˆ  ì¤‘ ìƒí™©ì— ë”°ë¼ ê°œë³µìˆ˜ìˆ ë¡œ ì „í™˜ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
      "transfusion_possibility": "ì¼ë°˜ì ìœ¼ë¡œ ì¶œí˜ˆì´ ì ì–´ ìˆ˜í˜ˆì´ í•„ìš”í•œ ê²½ìš°ëŠ” ë“œë­…ë‹ˆë‹¤.", \
      "surgeon_change_possibility": "ì‘ê¸‰ìƒí™© ì‹œ ë‹¤ë¥¸ ìˆ™ë ¨ëœ ì™¸ê³¼ì˜ì‚¬ê°€ ìˆ˜ìˆ ì„ ëŒ€ì‹ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤." \
    }, \
    "possible_complications_sequelae": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì˜ í•©ë³‘ì¦ìœ¼ë¡œëŠ” ì¶œí˜ˆ, ê°ì—¼, ë§ˆì·¨ ê´€ë ¨ í•©ë³‘ì¦, ì‹ ê²½ ì†ìƒ, í˜ˆê´€ ì†ìƒ ë“±ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
    "emergency_measures": "ìˆ˜ìˆ  ì¤‘ ë˜ëŠ” ìˆ˜ìˆ  í›„ ì‘ê¸‰ìƒí™© ë°œìƒ ì‹œ ì¦‰ì‹œ ì‘ê¸‰ì²˜ì¹˜ë¥¼ ì‹œí–‰í•˜ê²Œ ë©ë‹ˆë‹¤.", \
    "mortality_risk": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì•ˆì „í•˜ì§€ë§Œ ë§¤ìš° ë“œë¬¼ê²Œ ì‚¬ë§ ìœ„í—˜ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤." \
  }, \
  "references": { \
    "prognosis_without_surgery": ["Acute cholecystitis complications"], \
    "alternative_treatments": ["Non-surgical treatment options"], \
    "surgery_purpose_necessity_effect": ["Laparoscopic cholecystectomy indications"], \
    "surgery_method_content": { \
      "overall_description": ["Laparoscopic cholecystectomy technique"], \
      "estimated_duration": ["Operative time factors"], \
      "method_change_or_addition": ["Conversion to open surgery"], \
      "transfusion_possibility": ["Blood transfusion guidelines"], \
      "surgeon_change_possibility": ["Surgical team management"] \
    }, \
    "possible_complications_sequelae": ["Surgical complications"], \
    "emergency_measures": ["Emergency procedures"], \
    "mortality_risk": ["Mortality statistics"] \
  } \
}' | curl -s -X POST http://localhost:8000/chat -H "Content-Type: application/json" -d @- | jq '.message, .is_content_modified'

# ì‰¬ìš´ ë§ë¡œ ë³€ê²½ ìš”ì²­ 
test-chat-simplify:
	echo '\
{ \
  "message": "ì´ ë™ì˜ì„œë¥¼ ë” ì‰¬ìš´ ë§ë¡œ ë°”ê¿”ì£¼ì„¸ìš”.", \
  "conversation_id": "$(CHAT_ID)", \
  "consents": { \
    "prognosis_without_surgery": "ë‹´ë‚­ê²°ì„ì— ëŒ€í•´ ìˆ˜ìˆ ì„ ì‹œí–‰í•˜ì§€ ì•Šì„ ê²½ìš°, ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ì§€ì†ì ì¸ ë³µí†µê³¼ ì†Œí™”ë¶ˆëŸ‰ìœ¼ë¡œ ì¼ìƒìƒí™œì— í° ì§€ìž¥ì„ ë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë‹´ë‚­ë²½ì´ ë‘êº¼ì›Œì§€ê³  ìœ ì°©ì´ ì‹¬í•´ì ¸ ìˆ˜ìˆ ì´ ë”ìš± ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
    "alternative_treatments": "ë‹´ë‚­ê²°ì„ ì¹˜ë£Œë¥¼ ìœ„í•œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” ì²´ì™¸ì¶©ê²©íŒŒì‡„ì„ìˆ (ESWL), ê²½êµ¬ ë‹´ì„ìš©í•´ì œ ë³µìš©, ê²½í”¼ì  ë‹´ë‚­ë°°ì•¡ìˆ  ë“±ì´ ìžˆìœ¼ë‚˜, ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ íš¨ê³¼ê°€ ì œí•œì ì´ê³  ìž¬ë°œë¥ ì´ ë†’ì•„ ê·¼ë³¸ì ì¸ ì¹˜ë£Œë²•ì¸ ìˆ˜ìˆ ì  ì¹˜ë£Œê°€ ê°€ìž¥ íš¨ê³¼ì ì¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìžˆìŠµë‹ˆë‹¤.", \
    "surgery_purpose_necessity_effect": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì˜ ëª©ì ì€ ë‹´ë‚­ê²°ì„ìœ¼ë¡œ ì¸í•œ ì—¼ì¦ê³¼ í†µì¦ì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ê³ , ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì„ ì˜ˆë°©í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ìˆ˜ìˆ ì„ í†µí•´ í™˜ìžì˜ ì‚¶ì˜ ì§ˆì„ í¬ê²Œ ê°œì„ í•˜ê³  ì •ìƒì ì¸ ì¼ìƒìƒí™œë¡œì˜ ë³µê·€ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.", \
    "surgery_method_content": { \
      "overall_description": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ë°°ì— 3-4ê°œì˜ ìž‘ì€ êµ¬ë©(5-12mm)ì„ ëš«ì–´ ì¹´ë©”ë¼(ë³µê°•ê²½)ì™€ ìˆ˜ìˆ ê¸°êµ¬ë¥¼ ë„£ì–´ ë‹´ë‚­ì„ ì œê±°í•˜ëŠ” ìµœì†Œì¹¨ìŠµ ìˆ˜ìˆ ìž…ë‹ˆë‹¤. ì „ì‹ ë§ˆì·¨ í•˜ì— ì´ì‚°í™”íƒ„ì†Œ ê°€ìŠ¤ë¥¼ ë„£ì–´ ë³µê°•ì„ ë¶€í’€ë¦° í›„, ë‹´ë‚­ë™ë§¥ê³¼ ë‹´ë‚­ê´€ì„ ì°¾ì•„ ì•ˆì „í•˜ê²Œ ì ˆë‹¨í•˜ê³  ë‹´ë‚­ì„ ì™„ì „ížˆ ì œê±°í•©ë‹ˆë‹¤.", \
      "estimated_duration": "ìˆ˜ìˆ  ì‹œê°„ì€ í™˜ìžì˜ ìƒíƒœì™€ ìˆ˜ìˆ ì˜ ë³µìž¡ì„±ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ 1-2ì‹œê°„ ì •ë„ ì†Œìš”ë˜ë©°, ìˆ˜ìˆ  ì „ ì¤€ë¹„ì‹œê°„ê³¼ ë§ˆì·¨ ì‹œê°„ì„ í¬í•¨í•˜ë©´ ì´ 3-4ì‹œê°„ ì •ë„ ì†Œìš”ë  ì˜ˆì •ìž…ë‹ˆë‹¤.", \
      "method_change_or_addition": "ìˆ˜ìˆ  ì¤‘ ì‹¬í•œ ì—¼ì¦, ìœ ì°©, ì¶œí˜ˆ, í•´ë¶€í•™ì  ì´ìƒ ë“±ìœ¼ë¡œ ì¸í•´ ë³µê°•ê²½ ìˆ˜ìˆ ì´ ì–´ë ¤ìš¸ ê²½ìš° í™˜ìžì˜ ì•ˆì „ì„ ìœ„í•´ ê°œë³µìˆ˜ìˆ ë¡œ ì „í™˜í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ë‹´ê´€ì†ìƒì´ë‚˜ ê¸°íƒ€ í•©ë³‘ì¦ ë°œìƒ ì‹œ ì¶”ê°€ì ì¸ ìˆ˜ìˆ  ì ˆì°¨ê°€ í•„ìš”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
      "transfusion_possibility": "ì¼ë°˜ì ìœ¼ë¡œ ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì¶œí˜ˆì´ ì ì€ ìˆ˜ìˆ ì´ë¯€ë¡œ ìˆ˜í˜ˆì´ í•„ìš”í•œ ê²½ìš°ëŠ” ë“œë¬¼ì§€ë§Œ, ì˜ˆìƒì¹˜ ëª»í•œ ëŒ€ëŸ‰ì¶œí˜ˆì´ë‚˜ í™˜ìžì˜ ë¹ˆí˜ˆ ìƒíƒœì— ë”°ë¼ ìˆ˜í˜ˆì´ í•„ìš”í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ì ì ˆí•œ í˜ˆì•¡ì œì œë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.", \
      "surgeon_change_possibility": "ìˆ˜ìˆ  ì¤‘ ì‘ê¸‰ìƒí™© ë°œìƒ, ì£¼ì¹˜ì˜ì˜ ì»¨ë””ì…˜ ë‚œì¡°, ë˜ëŠ” ê¸°íƒ€ ë¶ˆê°€í”¼í•œ ì‚¬ìœ ë¡œ ì¸í•´ ë‹¤ë¥¸ ìˆ™ë ¨ëœ ì™¸ê³¼ì˜ì‚¬ê°€ ìˆ˜ìˆ ì„ ëŒ€ì‹  ì§„í–‰í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ìˆ˜ìˆ ì˜ ì—°ì†ì„±ê³¼ ì•ˆì „ì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ ì¶©ë¶„í•œ ì¸ìˆ˜ì¸ê³„ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤." \
    }, \
    "possible_complications_sequelae": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ê³¼ ê´€ë ¨í•˜ì—¬ ë°œìƒ ê°€ëŠ¥í•œ í•©ë³‘ì¦ìœ¼ë¡œëŠ” ì¶œí˜ˆ, ê°ì—¼, ë‹´ê´€ì†ìƒ, ìž¥ê¸°ì†ìƒ, ë§ˆì·¨ ê´€ë ¨ í•©ë³‘ì¦ ë“±ì´ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ìˆ˜ìˆ  í›„ ì°½ìƒ ê°ì—¼, ë³µê°• ë‚´ ë†ì–‘ í˜•ì„±, ë‹´ì¦™ ëˆ„ì¶œ, ì¼ì‹œì  ì†Œí™”ë¶ˆëŸ‰ ë“±ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ë“œë¬¼ê²ŒëŠ” ìž¬ìˆ˜ìˆ ì´ í•„ìš”í•œ ê²½ìš°ë„ ìžˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ í•©ë³‘ì¦ì€ ì ì ˆí•œ ì¹˜ë£Œë¥¼ í†µí•´ íšŒë³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.", \
    "emergency_measures": "ìˆ˜ìˆ  ì¤‘ ë˜ëŠ” ìˆ˜ìˆ  í›„ ì‘ê¸‰ìƒí™©(ëŒ€ëŸ‰ì¶œí˜ˆ, ìž¥ê¸°ì†ìƒ, ë‹´ì¦™ëˆ„ì¶œ, ê°ì—¼ ë“±) ë°œìƒ ì‹œ ì¦‰ì‹œ ì‘ê¸‰ì²˜ì¹˜ë¥¼ ì‹œí–‰í•˜ê³ , í•„ìš”ì— ë”°ë¼ ì¤‘í™˜ìžì‹¤ ìž…ì›, ìž¬ìˆ˜ìˆ , ì¸í„°ë²¤ì…˜ ì‹œìˆ , í•­ìƒì œ ì¹˜ë£Œ, ìˆ˜í˜ˆ ë“±ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê²Œ ë©ë‹ˆë‹¤. 24ì‹œê°„ ì˜ë£Œì§„ì´ ëŒ€ê¸°í•˜ì—¬ ëª¨ë“  ì‘ê¸‰ìƒí™©ì— ì‹ ì†í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìžˆëŠ” ì²´ê³„ë¥¼ ê°–ì¶”ê³  ìžˆìŠµë‹ˆë‹¤.", \
    "mortality_risk": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì•ˆì „í•œ ìˆ˜ìˆ ë¡œ ì•Œë ¤ì ¸ ìžˆìœ¼ë‚˜, ëª¨ë“  ìˆ˜ìˆ ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë§¤ìš° ë“œë¬¼ê²Œ ì‚¬ë§ì˜ ìœ„í—˜ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì‚¬ë§ ìœ„í—˜ë„ëŠ” í™˜ìžì˜ ë‚˜ì´, ì „ì‹ ìƒíƒœ, ë™ë°˜ì§ˆí™˜, ìˆ˜ìˆ ì˜ ë³µìž¡ì„± ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•  ë•Œ 1% ë¯¸ë§Œìœ¼ë¡œ ì˜ˆìƒë˜ë©°, ë§ˆì·¨ ê´€ë ¨ ìœ„í—˜ë„ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. ëª¨ë“  ì•ˆì „ì¡°ì¹˜ë¥¼ í†µí•´ ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ìžˆìŠµë‹ˆë‹¤." \
  }, \
  "references": { \
    "prognosis_without_surgery": [], \
    "alternative_treatments": [], \
    "surgery_purpose_necessity_effect": [], \
    "surgery_method_content": { \
      "overall_description": [], \
      "estimated_duration": [], \
      "method_change_or_addition": [], \
      "transfusion_possibility": [], \
      "surgeon_change_possibility": [] \
    }, \
    "possible_complications_sequelae": [], \
    "emergency_measures": [], \
    "mortality_risk": [] \
  } \
}' | \
	curl -X POST http://localhost:8000/chat \
	     -H "Content-Type: application/json" \
	     -d @-

# ìš”ì•½ ìš”ì²­
test-chat-summary:
	echo '\
{ \
  "message": "ì´ ë™ì˜ì„œ ë‚´ìš©ì„ 5ì¤„ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”.", \
  "conversation_id": "$(CHAT_ID)", \
  "consents": { \
    "prognosis_without_surgery": "ë‹´ë‚­ê²°ì„ì— ëŒ€í•´ ìˆ˜ìˆ ì„ ì‹œí–‰í•˜ì§€ ì•Šì„ ê²½ìš°, ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ì§€ì†ì ì¸ ë³µí†µê³¼ ì†Œí™”ë¶ˆëŸ‰ìœ¼ë¡œ ì¼ìƒìƒí™œì— í° ì§€ìž¥ì„ ë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë‹´ë‚­ë²½ì´ ë‘êº¼ì›Œì§€ê³  ìœ ì°©ì´ ì‹¬í•´ì ¸ ìˆ˜ìˆ ì´ ë”ìš± ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
    "alternative_treatments": "ë‹´ë‚­ê²°ì„ ì¹˜ë£Œë¥¼ ìœ„í•œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” ì²´ì™¸ì¶©ê²©íŒŒì‡„ì„ìˆ (ESWL), ê²½êµ¬ ë‹´ì„ìš©í•´ì œ ë³µìš©, ê²½í”¼ì  ë‹´ë‚­ë°°ì•¡ìˆ  ë“±ì´ ìžˆìœ¼ë‚˜, ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ íš¨ê³¼ê°€ ì œí•œì ì´ê³  ìž¬ë°œë¥ ì´ ë†’ì•„ ê·¼ë³¸ì ì¸ ì¹˜ë£Œë²•ì¸ ìˆ˜ìˆ ì  ì¹˜ë£Œê°€ ê°€ìž¥ íš¨ê³¼ì ì¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìžˆìŠµë‹ˆë‹¤.", \
    "surgery_purpose_necessity_effect": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì˜ ëª©ì ì€ ë‹´ë‚­ê²°ì„ìœ¼ë¡œ ì¸í•œ ì—¼ì¦ê³¼ í†µì¦ì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ê³ , ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì„ ì˜ˆë°©í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ìˆ˜ìˆ ì„ í†µí•´ í™˜ìžì˜ ì‚¶ì˜ ì§ˆì„ í¬ê²Œ ê°œì„ í•˜ê³  ì •ìƒì ì¸ ì¼ìƒìƒí™œë¡œì˜ ë³µê·€ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.", \
    "surgery_method_content": { \
      "overall_description": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ë°°ì— 3-4ê°œì˜ ìž‘ì€ êµ¬ë©(5-12mm)ì„ ëš«ì–´ ì¹´ë©”ë¼(ë³µê°•ê²½)ì™€ ìˆ˜ìˆ ê¸°êµ¬ë¥¼ ë„£ì–´ ë‹´ë‚­ì„ ì œê±°í•˜ëŠ” ìµœì†Œì¹¨ìŠµ ìˆ˜ìˆ ìž…ë‹ˆë‹¤. ì „ì‹ ë§ˆì·¨ í•˜ì— ì´ì‚°í™”íƒ„ì†Œ ê°€ìŠ¤ë¥¼ ë„£ì–´ ë³µê°•ì„ ë¶€í’€ë¦° í›„, ë‹´ë‚­ë™ë§¥ê³¼ ë‹´ë‚­ê´€ì„ ì°¾ì•„ ì•ˆì „í•˜ê²Œ ì ˆë‹¨í•˜ê³  ë‹´ë‚­ì„ ì™„ì „ížˆ ì œê±°í•©ë‹ˆë‹¤.", \
      "estimated_duration": "ìˆ˜ìˆ  ì‹œê°„ì€ í™˜ìžì˜ ìƒíƒœì™€ ìˆ˜ìˆ ì˜ ë³µìž¡ì„±ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ 1-2ì‹œê°„ ì •ë„ ì†Œìš”ë˜ë©°, ìˆ˜ìˆ  ì „ ì¤€ë¹„ì‹œê°„ê³¼ ë§ˆì·¨ ì‹œê°„ì„ í¬í•¨í•˜ë©´ ì´ 3-4ì‹œê°„ ì •ë„ ì†Œìš”ë  ì˜ˆì •ìž…ë‹ˆë‹¤.", \
      "method_change_or_addition": "ìˆ˜ìˆ  ì¤‘ ì‹¬í•œ ì—¼ì¦, ìœ ì°©, ì¶œí˜ˆ, í•´ë¶€í•™ì  ì´ìƒ ë“±ìœ¼ë¡œ ì¸í•´ ë³µê°•ê²½ ìˆ˜ìˆ ì´ ì–´ë ¤ìš¸ ê²½ìš° í™˜ìžì˜ ì•ˆì „ì„ ìœ„í•´ ê°œë³µìˆ˜ìˆ ë¡œ ì „í™˜í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ë‹´ê´€ì†ìƒì´ë‚˜ ê¸°íƒ€ í•©ë³‘ì¦ ë°œìƒ ì‹œ ì¶”ê°€ì ì¸ ìˆ˜ìˆ  ì ˆì°¨ê°€ í•„ìš”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
      "transfusion_possibility": "ì¼ë°˜ì ìœ¼ë¡œ ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì¶œí˜ˆì´ ì ì€ ìˆ˜ìˆ ì´ë¯€ë¡œ ìˆ˜í˜ˆì´ í•„ìš”í•œ ê²½ìš°ëŠ” ë“œë¬¼ì§€ë§Œ, ì˜ˆìƒì¹˜ ëª»í•œ ëŒ€ëŸ‰ì¶œí˜ˆì´ë‚˜ í™˜ìžì˜ ë¹ˆí˜ˆ ìƒíƒœì— ë”°ë¼ ìˆ˜í˜ˆì´ í•„ìš”í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ì ì ˆí•œ í˜ˆì•¡ì œì œë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.", \
      "surgeon_change_possibility": "ìˆ˜ìˆ  ì¤‘ ì‘ê¸‰ìƒí™© ë°œìƒ, ì£¼ì¹˜ì˜ì˜ ì»¨ë””ì…˜ ë‚œì¡°, ë˜ëŠ” ê¸°íƒ€ ë¶ˆê°€í”¼í•œ ì‚¬ìœ ë¡œ ì¸í•´ ë‹¤ë¥¸ ìˆ™ë ¨ëœ ì™¸ê³¼ì˜ì‚¬ê°€ ìˆ˜ìˆ ì„ ëŒ€ì‹  ì§„í–‰í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ìˆ˜ìˆ ì˜ ì—°ì†ì„±ê³¼ ì•ˆì „ì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ ì¶©ë¶„í•œ ì¸ìˆ˜ì¸ê³„ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤." \
    }, \
    "possible_complications_sequelae": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ê³¼ ê´€ë ¨í•˜ì—¬ ë°œìƒ ê°€ëŠ¥í•œ í•©ë³‘ì¦ìœ¼ë¡œëŠ” ì¶œí˜ˆ, ê°ì—¼, ë‹´ê´€ì†ìƒ, ìž¥ê¸°ì†ìƒ, ë§ˆì·¨ ê´€ë ¨ í•©ë³‘ì¦ ë“±ì´ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ìˆ˜ìˆ  í›„ ì°½ìƒ ê°ì—¼, ë³µê°• ë‚´ ë†ì–‘ í˜•ì„±, ë‹´ì¦™ ëˆ„ì¶œ, ì¼ì‹œì  ì†Œí™”ë¶ˆëŸ‰ ë“±ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ë“œë¬¼ê²ŒëŠ” ìž¬ìˆ˜ìˆ ì´ í•„ìš”í•œ ê²½ìš°ë„ ìžˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ í•©ë³‘ì¦ì€ ì ì ˆí•œ ì¹˜ë£Œë¥¼ í†µí•´ íšŒë³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.", \
    "emergency_measures": "ìˆ˜ìˆ  ì¤‘ ë˜ëŠ” ìˆ˜ìˆ  í›„ ì‘ê¸‰ìƒí™©(ëŒ€ëŸ‰ì¶œí˜ˆ, ìž¥ê¸°ì†ìƒ, ë‹´ì¦™ëˆ„ì¶œ, ê°ì—¼ ë“±) ë°œìƒ ì‹œ ì¦‰ì‹œ ì‘ê¸‰ì²˜ì¹˜ë¥¼ ì‹œí–‰í•˜ê³ , í•„ìš”ì— ë”°ë¼ ì¤‘í™˜ìžì‹¤ ìž…ì›, ìž¬ìˆ˜ìˆ , ì¸í„°ë²¤ì…˜ ì‹œìˆ , í•­ìƒì œ ì¹˜ë£Œ, ìˆ˜í˜ˆ ë“±ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê²Œ ë©ë‹ˆë‹¤. 24ì‹œê°„ ì˜ë£Œì§„ì´ ëŒ€ê¸°í•˜ì—¬ ëª¨ë“  ì‘ê¸‰ìƒí™©ì— ì‹ ì†í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìžˆëŠ” ì²´ê³„ë¥¼ ê°–ì¶”ê³  ìžˆìŠµë‹ˆë‹¤.", \
    "mortality_risk": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì•ˆì „í•œ ìˆ˜ìˆ ë¡œ ì•Œë ¤ì ¸ ìžˆìœ¼ë‚˜, ëª¨ë“  ìˆ˜ìˆ ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë§¤ìš° ë“œë¬¼ê²Œ ì‚¬ë§ì˜ ìœ„í—˜ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì‚¬ë§ ìœ„í—˜ë„ëŠ” í™˜ìžì˜ ë‚˜ì´, ì „ì‹ ìƒíƒœ, ë™ë°˜ì§ˆí™˜, ìˆ˜ìˆ ì˜ ë³µìž¡ì„± ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•  ë•Œ 1% ë¯¸ë§Œìœ¼ë¡œ ì˜ˆìƒë˜ë©°, ë§ˆì·¨ ê´€ë ¨ ìœ„í—˜ë„ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. ëª¨ë“  ì•ˆì „ì¡°ì¹˜ë¥¼ í†µí•´ ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ìžˆìŠµë‹ˆë‹¤." \
  }, \
  "references": { \
    "prognosis_without_surgery": [], \
    "alternative_treatments": [], \
    "surgery_purpose_necessity_effect": [], \
    "surgery_method_content": { \
      "overall_description": [], \
      "estimated_duration": [], \
      "method_change_or_addition": [], \
      "transfusion_possibility": [], \
      "surgeon_change_possibility": [] \
    }, \
    "possible_complications_sequelae": [], \
    "emergency_measures": [], \
    "mortality_risk": [] \
  } \
}' | \
	curl -X POST http://localhost:8000/chat \
	     -H "Content-Type: application/json" \
	     -d @-

# ì˜ì–´ ë²ˆì—­ ìš”ì²­
test-chat-translate:
	echo '\
{ \
  "message": "ì´ ë™ì˜ì„œë¥¼ ì˜ì–´ë¡œ ë²ˆì—­í•´ì£¼ì„¸ìš”.", \
  "conversation_id": "$(CHAT_ID)", \
  "consents": { \
    "prognosis_without_surgery": "ë‹´ë‚­ê²°ì„ì— ëŒ€í•´ ìˆ˜ìˆ ì„ ì‹œí–‰í•˜ì§€ ì•Šì„ ê²½ìš°, ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ì§€ì†ì ì¸ ë³µí†µê³¼ ì†Œí™”ë¶ˆëŸ‰ìœ¼ë¡œ ì¼ìƒìƒí™œì— í° ì§€ìž¥ì„ ë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë‹´ë‚­ë²½ì´ ë‘êº¼ì›Œì§€ê³  ìœ ì°©ì´ ì‹¬í•´ì ¸ ìˆ˜ìˆ ì´ ë”ìš± ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
    "alternative_treatments": "ë‹´ë‚­ê²°ì„ ì¹˜ë£Œë¥¼ ìœ„í•œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” ì²´ì™¸ì¶©ê²©íŒŒì‡„ì„ìˆ (ESWL), ê²½êµ¬ ë‹´ì„ìš©í•´ì œ ë³µìš©, ê²½í”¼ì  ë‹´ë‚­ë°°ì•¡ìˆ  ë“±ì´ ìžˆìœ¼ë‚˜, ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ íš¨ê³¼ê°€ ì œí•œì ì´ê³  ìž¬ë°œë¥ ì´ ë†’ì•„ ê·¼ë³¸ì ì¸ ì¹˜ë£Œë²•ì¸ ìˆ˜ìˆ ì  ì¹˜ë£Œê°€ ê°€ìž¥ íš¨ê³¼ì ì¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìžˆìŠµë‹ˆë‹¤.", \
    "surgery_purpose_necessity_effect": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì˜ ëª©ì ì€ ë‹´ë‚­ê²°ì„ìœ¼ë¡œ ì¸í•œ ì—¼ì¦ê³¼ í†µì¦ì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ê³ , ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì„ ì˜ˆë°©í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ìˆ˜ìˆ ì„ í†µí•´ í™˜ìžì˜ ì‚¶ì˜ ì§ˆì„ í¬ê²Œ ê°œì„ í•˜ê³  ì •ìƒì ì¸ ì¼ìƒìƒí™œë¡œì˜ ë³µê·€ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.", \
    "surgery_method_content": { \
      "overall_description": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ë°°ì— 3-4ê°œì˜ ìž‘ì€ êµ¬ë©(5-12mm)ì„ ëš«ì–´ ì¹´ë©”ë¼(ë³µê°•ê²½)ì™€ ìˆ˜ìˆ ê¸°êµ¬ë¥¼ ë„£ì–´ ë‹´ë‚­ì„ ì œê±°í•˜ëŠ” ìµœì†Œì¹¨ìŠµ ìˆ˜ìˆ ìž…ë‹ˆë‹¤. ì „ì‹ ë§ˆì·¨ í•˜ì— ì´ì‚°í™”íƒ„ì†Œ ê°€ìŠ¤ë¥¼ ë„£ì–´ ë³µê°•ì„ ë¶€í’€ë¦° í›„, ë‹´ë‚­ë™ë§¥ê³¼ ë‹´ë‚­ê´€ì„ ì°¾ì•„ ì•ˆì „í•˜ê²Œ ì ˆë‹¨í•˜ê³  ë‹´ë‚­ì„ ì™„ì „ížˆ ì œê±°í•©ë‹ˆë‹¤.", \
      "estimated_duration": "ìˆ˜ìˆ  ì‹œê°„ì€ í™˜ìžì˜ ìƒíƒœì™€ ìˆ˜ìˆ ì˜ ë³µìž¡ì„±ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ 1-2ì‹œê°„ ì •ë„ ì†Œìš”ë˜ë©°, ìˆ˜ìˆ  ì „ ì¤€ë¹„ì‹œê°„ê³¼ ë§ˆì·¨ ì‹œê°„ì„ í¬í•¨í•˜ë©´ ì´ 3-4ì‹œê°„ ì •ë„ ì†Œìš”ë  ì˜ˆì •ìž…ë‹ˆë‹¤.", \
      "method_change_or_addition": "ìˆ˜ìˆ  ì¤‘ ì‹¬í•œ ì—¼ì¦, ìœ ì°©, ì¶œí˜ˆ, í•´ë¶€í•™ì  ì´ìƒ ë“±ìœ¼ë¡œ ì¸í•´ ë³µê°•ê²½ ìˆ˜ìˆ ì´ ì–´ë ¤ìš¸ ê²½ìš° í™˜ìžì˜ ì•ˆì „ì„ ìœ„í•´ ê°œë³µìˆ˜ìˆ ë¡œ ì „í™˜í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ë‹´ê´€ì†ìƒì´ë‚˜ ê¸°íƒ€ í•©ë³‘ì¦ ë°œìƒ ì‹œ ì¶”ê°€ì ì¸ ìˆ˜ìˆ  ì ˆì°¨ê°€ í•„ìš”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
      "transfusion_possibility": "ì¼ë°˜ì ìœ¼ë¡œ ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì¶œí˜ˆì´ ì ì€ ìˆ˜ìˆ ì´ë¯€ë¡œ ìˆ˜í˜ˆì´ í•„ìš”í•œ ê²½ìš°ëŠ” ë“œë¬¼ì§€ë§Œ, ì˜ˆìƒì¹˜ ëª»í•œ ëŒ€ëŸ‰ì¶œí˜ˆì´ë‚˜ í™˜ìžì˜ ë¹ˆí˜ˆ ìƒíƒœì— ë”°ë¼ ìˆ˜í˜ˆì´ í•„ìš”í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ì ì ˆí•œ í˜ˆì•¡ì œì œë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.", \
      "surgeon_change_possibility": "ìˆ˜ìˆ  ì¤‘ ì‘ê¸‰ìƒí™© ë°œìƒ, ì£¼ì¹˜ì˜ì˜ ì»¨ë””ì…˜ ë‚œì¡°, ë˜ëŠ” ê¸°íƒ€ ë¶ˆê°€í”¼í•œ ì‚¬ìœ ë¡œ ì¸í•´ ë‹¤ë¥¸ ìˆ™ë ¨ëœ ì™¸ê³¼ì˜ì‚¬ê°€ ìˆ˜ìˆ ì„ ëŒ€ì‹  ì§„í–‰í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ìˆ˜ìˆ ì˜ ì—°ì†ì„±ê³¼ ì•ˆì „ì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ ì¶©ë¶„í•œ ì¸ìˆ˜ì¸ê³„ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤." \
    }, \
    "possible_complications_sequelae": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ê³¼ ê´€ë ¨í•˜ì—¬ ë°œìƒ ê°€ëŠ¥í•œ í•©ë³‘ì¦ìœ¼ë¡œëŠ” ì¶œí˜ˆ, ê°ì—¼, ë‹´ê´€ì†ìƒ, ìž¥ê¸°ì†ìƒ, ë§ˆì·¨ ê´€ë ¨ í•©ë³‘ì¦ ë“±ì´ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ìˆ˜ìˆ  í›„ ì°½ìƒ ê°ì—¼, ë³µê°• ë‚´ ë†ì–‘ í˜•ì„±, ë‹´ì¦™ ëˆ„ì¶œ, ì¼ì‹œì  ì†Œí™”ë¶ˆëŸ‰ ë“±ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ë“œë¬¼ê²ŒëŠ” ìž¬ìˆ˜ìˆ ì´ í•„ìš”í•œ ê²½ìš°ë„ ìžˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ í•©ë³‘ì¦ì€ ì ì ˆí•œ ì¹˜ë£Œë¥¼ í†µí•´ íšŒë³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.", \
    "emergency_measures": "ìˆ˜ìˆ  ì¤‘ ë˜ëŠ” ìˆ˜ìˆ  í›„ ì‘ê¸‰ìƒí™©(ëŒ€ëŸ‰ì¶œí˜ˆ, ìž¥ê¸°ì†ìƒ, ë‹´ì¦™ëˆ„ì¶œ, ê°ì—¼ ë“±) ë°œìƒ ì‹œ ì¦‰ì‹œ ì‘ê¸‰ì²˜ì¹˜ë¥¼ ì‹œí–‰í•˜ê³ , í•„ìš”ì— ë”°ë¼ ì¤‘í™˜ìžì‹¤ ìž…ì›, ìž¬ìˆ˜ìˆ , ì¸í„°ë²¤ì…˜ ì‹œìˆ , í•­ìƒì œ ì¹˜ë£Œ, ìˆ˜í˜ˆ ë“±ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê²Œ ë©ë‹ˆë‹¤. 24ì‹œê°„ ì˜ë£Œì§„ì´ ëŒ€ê¸°í•˜ì—¬ ëª¨ë“  ì‘ê¸‰ìƒí™©ì— ì‹ ì†í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìžˆëŠ” ì²´ê³„ë¥¼ ê°–ì¶”ê³  ìžˆìŠµë‹ˆë‹¤.", \
    "mortality_risk": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì•ˆì „í•œ ìˆ˜ìˆ ë¡œ ì•Œë ¤ì ¸ ìžˆìœ¼ë‚˜, ëª¨ë“  ìˆ˜ìˆ ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë§¤ìš° ë“œë¬¼ê²Œ ì‚¬ë§ì˜ ìœ„í—˜ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì‚¬ë§ ìœ„í—˜ë„ëŠ” í™˜ìžì˜ ë‚˜ì´, ì „ì‹ ìƒíƒœ, ë™ë°˜ì§ˆí™˜, ìˆ˜ìˆ ì˜ ë³µìž¡ì„± ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•  ë•Œ 1% ë¯¸ë§Œìœ¼ë¡œ ì˜ˆìƒë˜ë©°, ë§ˆì·¨ ê´€ë ¨ ìœ„í—˜ë„ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. ëª¨ë“  ì•ˆì „ì¡°ì¹˜ë¥¼ í†µí•´ ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ìžˆìŠµë‹ˆë‹¤." \
  }, \
  "references": { \
    "prognosis_without_surgery": [], \
    "alternative_treatments": [], \
    "surgery_purpose_necessity_effect": [], \
    "surgery_method_content": { \
      "overall_description": [], \
      "estimated_duration": [], \
      "method_change_or_addition": [], \
      "transfusion_possibility": [], \
      "surgeon_change_possibility": [] \
    }, \
    "possible_complications_sequelae": [], \
    "emergency_measures": [], \
    "mortality_risk": [] \
  }, \
  "mode": "translate_en" \
}' | \
	curl -X POST http://localhost:8000/transform \
	     -H "Content-Type: application/json" \
	     -d @-

test-chat-history:
	curl -X GET http://localhost:8000/chat/$(CHAT_ID)/history

test-chat-list:
	curl -X GET http://localhost:8000/chat/sessions

test-chat-delete:
	curl -X DELETE http://localhost:8000/chat/$(CHAT_ID)


# í†µí•© ì±„íŒ… ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
test-chat-flow:
	@echo "=== ðŸ¥ ìˆ˜ìˆ  ë™ì˜ì„œ í†µí•© ì±„íŒ… ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ==="
	@echo ""
	@echo "=== 1ë‹¨ê³„: ì¼ë°˜ ì§ˆë¬¸ (ë™ì˜ì„œ ë°ì´í„° ì—†ìŒ) ==="
	@echo '{"message": "ë³µê°•ê²½ ìˆ˜ìˆ ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.", "system_prompt": "ë‹¹ì‹ ì€ ìˆ˜ìˆ  ë™ì˜ì„œ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤. í™˜ìžê°€ ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”."}' | \
	curl -s -X POST http://localhost:8000/chat \
	     -H "Content-Type: application/json" \
	     -d @- | jq '.message, .is_content_modified'
	@echo ""
	@echo "=== 2ë‹¨ê³„: ë™ì˜ì„œ ë°ì´í„°ì™€ í•¨ê»˜ ì§ˆë¬¸ ==="
	@echo '{ \
	  "message": "ì´ ìˆ˜ìˆ ì˜ í•©ë³‘ì¦ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.", \
	  "consents": { \
	    "prognosis_without_surgery": "ë‹´ë‚­ê²°ì„ì— ëŒ€í•´ ìˆ˜ìˆ ì„ ì‹œí–‰í•˜ì§€ ì•Šì„ ê²½ìš°, ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ì§€ì†ì ì¸ ë³µí†µê³¼ ì†Œí™”ë¶ˆëŸ‰ìœ¼ë¡œ ì¼ìƒìƒí™œì— í° ì§€ìž¥ì„ ë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë‹´ë‚­ë²½ì´ ë‘êº¼ì›Œì§€ê³  ìœ ì°©ì´ ì‹¬í•´ì ¸ ìˆ˜ìˆ ì´ ë”ìš± ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
	    "alternative_treatments": "ë‹´ë‚­ê²°ì„ ì¹˜ë£Œë¥¼ ìœ„í•œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” ì²´ì™¸ì¶©ê²©íŒŒì‡„ì„ìˆ (ESWL), ê²½êµ¬ ë‹´ì„ìš©í•´ì œ ë³µìš©, ê²½í”¼ì  ë‹´ë‚­ë°°ì•¡ìˆ  ë“±ì´ ìžˆìœ¼ë‚˜, ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ íš¨ê³¼ê°€ ì œí•œì ì´ê³  ìž¬ë°œë¥ ì´ ë†’ì•„ ê·¼ë³¸ì ì¸ ì¹˜ë£Œë²•ì¸ ìˆ˜ìˆ ì  ì¹˜ë£Œê°€ ê°€ìž¥ íš¨ê³¼ì ì¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìžˆìŠµë‹ˆë‹¤.", \
	    "surgery_purpose_necessity_effect": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì˜ ëª©ì ì€ ë‹´ë‚­ê²°ì„ìœ¼ë¡œ ì¸í•œ ì—¼ì¦ê³¼ í†µì¦ì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ê³ , ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì„ ì˜ˆë°©í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ìˆ˜ìˆ ì„ í†µí•´ í™˜ìžì˜ ì‚¶ì˜ ì§ˆì„ í¬ê²Œ ê°œì„ í•˜ê³  ì •ìƒì ì¸ ì¼ìƒìƒí™œë¡œì˜ ë³µê·€ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.", \
	    "surgery_method_content": { \
	      "overall_description": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ë°°ì— 3-4ê°œì˜ ìž‘ì€ êµ¬ë©(5-12mm)ì„ ëš«ì–´ ì¹´ë©”ë¼(ë³µê°•ê²½)ì™€ ìˆ˜ìˆ ê¸°êµ¬ë¥¼ ë„£ì–´ ë‹´ë‚­ì„ ì œê±°í•˜ëŠ” ìµœì†Œì¹¨ìŠµ ìˆ˜ìˆ ìž…ë‹ˆë‹¤. ì „ì‹ ë§ˆì·¨ í•˜ì— ì´ì‚°í™”íƒ„ì†Œ ê°€ìŠ¤ë¥¼ ë„£ì–´ ë³µê°•ì„ ë¶€í’€ë¦° í›„, ë‹´ë‚­ë™ë§¥ê³¼ ë‹´ë‚­ê´€ì„ ì°¾ì•„ ì•ˆì „í•˜ê²Œ ì ˆë‹¨í•˜ê³  ë‹´ë‚­ì„ ì™„ì „ížˆ ì œê±°í•©ë‹ˆë‹¤.", \
	      "estimated_duration": "ìˆ˜ìˆ  ì‹œê°„ì€ í™˜ìžì˜ ìƒíƒœì™€ ìˆ˜ìˆ ì˜ ë³µìž¡ì„±ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ 1-2ì‹œê°„ ì •ë„ ì†Œìš”ë˜ë©°, ìˆ˜ìˆ  ì „ ì¤€ë¹„ì‹œê°„ê³¼ ë§ˆì·¨ ì‹œê°„ì„ í¬í•¨í•˜ë©´ ì´ 3-4ì‹œê°„ ì •ë„ ì†Œìš”ë  ì˜ˆì •ìž…ë‹ˆë‹¤.", \
	      "method_change_or_addition": "ìˆ˜ìˆ  ì¤‘ ì‹¬í•œ ì—¼ì¦, ìœ ì°©, ì¶œí˜ˆ, í•´ë¶€í•™ì  ì´ìƒ ë“±ìœ¼ë¡œ ì¸í•´ ë³µê°•ê²½ ìˆ˜ìˆ ì´ ì–´ë ¤ìš¸ ê²½ìš° í™˜ìžì˜ ì•ˆì „ì„ ìœ„í•´ ê°œë³µìˆ˜ìˆ ë¡œ ì „í™˜í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ë‹´ê´€ì†ìƒì´ë‚˜ ê¸°íƒ€ í•©ë³‘ì¦ ë°œìƒ ì‹œ ì¶”ê°€ì ì¸ ìˆ˜ìˆ  ì ˆì°¨ê°€ í•„ìš”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
	      "transfusion_possibility": "ì¼ë°˜ì ìœ¼ë¡œ ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì¶œí˜ˆì´ ì ì€ ìˆ˜ìˆ ì´ë¯€ë¡œ ìˆ˜í˜ˆì´ í•„ìš”í•œ ê²½ìš°ëŠ” ë“œë¬¼ì§€ë§Œ, ì˜ˆìƒì¹˜ ëª»í•œ ëŒ€ëŸ‰ì¶œí˜ˆì´ë‚˜ í™˜ìžì˜ ë¹ˆí˜ˆ ìƒíƒœì— ë”°ë¼ ìˆ˜í˜ˆì´ í•„ìš”í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ì ì ˆí•œ í˜ˆì•¡ì œì œë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.", \
	      "surgeon_change_possibility": "ìˆ˜ìˆ  ì¤‘ ì‘ê¸‰ìƒí™© ë°œìƒ, ì£¼ì¹˜ì˜ì˜ ì»¨ë””ì…˜ ë‚œì¡°, ë˜ëŠ” ê¸°íƒ€ ë¶ˆê°€í”¼í•œ ì‚¬ìœ ë¡œ ì¸í•´ ë‹¤ë¥¸ ìˆ™ë ¨ëœ ì™¸ê³¼ì˜ì‚¬ê°€ ìˆ˜ìˆ ì„ ëŒ€ì‹  ì§„í–‰í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ìˆ˜ìˆ ì˜ ì—°ì†ì„±ê³¼ ì•ˆì „ì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ ì¶©ë¶„í•œ ì¸ìˆ˜ì¸ê³„ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤." \
	    }, \
	    "possible_complications_sequelae": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ê³¼ ê´€ë ¨í•˜ì—¬ ë°œìƒ ê°€ëŠ¥í•œ í•©ë³‘ì¦ìœ¼ë¡œëŠ” ì¶œí˜ˆ, ê°ì—¼, ë‹´ê´€ì†ìƒ, ìž¥ê¸°ì†ìƒ, ë§ˆì·¨ ê´€ë ¨ í•©ë³‘ì¦ ë“±ì´ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ìˆ˜ìˆ  í›„ ì°½ìƒ ê°ì—¼, ë³µê°• ë‚´ ë†ì–‘ í˜•ì„±, ë‹´ì¦™ ëˆ„ì¶œ, ì¼ì‹œì  ì†Œí™”ë¶ˆëŸ‰ ë“±ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ë“œë¬¼ê²ŒëŠ” ìž¬ìˆ˜ìˆ ì´ í•„ìš”í•œ ê²½ìš°ë„ ìžˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ í•©ë³‘ì¦ì€ ì ì ˆí•œ ì¹˜ë£Œë¥¼ í†µí•´ íšŒë³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.", \
	    "emergency_measures": "ìˆ˜ìˆ  ì¤‘ ë˜ëŠ” ìˆ˜ìˆ  í›„ ì‘ê¸‰ìƒí™©(ëŒ€ëŸ‰ì¶œí˜ˆ, ìž¥ê¸°ì†ìƒ, ë‹´ì¦™ëˆ„ì¶œ, ê°ì—¼ ë“±) ë°œìƒ ì‹œ ì¦‰ì‹œ ì‘ê¸‰ì²˜ì¹˜ë¥¼ ì‹œí–‰í•˜ê³ , í•„ìš”ì— ë”°ë¼ ì¤‘í™˜ìžì‹¤ ìž…ì›, ìž¬ìˆ˜ìˆ , ì¸í„°ë²¤ì…˜ ì‹œìˆ , í•­ìƒì œ ì¹˜ë£Œ, ìˆ˜í˜ˆ ë“±ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê²Œ ë©ë‹ˆë‹¤. 24ì‹œê°„ ì˜ë£Œì§„ì´ ëŒ€ê¸°í•˜ì—¬ ëª¨ë“  ì‘ê¸‰ìƒí™©ì— ì‹ ì†í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìžˆëŠ” ì²´ê³„ë¥¼ ê°–ì¶”ê³  ìžˆìŠµë‹ˆë‹¤.", \
	    "mortality_risk": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì•ˆì „í•œ ìˆ˜ìˆ ë¡œ ì•Œë ¤ì ¸ ìžˆìœ¼ë‚˜, ëª¨ë“  ìˆ˜ìˆ ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë§¤ìš° ë“œë¬¼ê²Œ ì‚¬ë§ì˜ ìœ„í—˜ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì‚¬ë§ ìœ„í—˜ë„ëŠ” í™˜ìžì˜ ë‚˜ì´, ì „ì‹ ìƒíƒœ, ë™ë°˜ì§ˆí™˜, ìˆ˜ìˆ ì˜ ë³µìž¡ì„± ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•  ë•Œ 1% ë¯¸ë§Œìœ¼ë¡œ ì˜ˆìƒë˜ë©°, ë§ˆì·¨ ê´€ë ¨ ìœ„í—˜ë„ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. ëª¨ë“  ì•ˆì „ì¡°ì¹˜ë¥¼ í†µí•´ ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ìžˆìŠµë‹ˆë‹¤." \
	  }, \
	  "references": { \
	    "prognosis_without_surgery": [{"title": "Acute cholecystitis complications", "url": "https://www.uptodate.com/contents/acute-cholecystitis", "text": "Acute cholecystitis complications"}], \
	    "alternative_treatments": [{"title": "Non-surgical treatment options", "url": "https://www.cochranelibrary.com/gallstones", "text": "Non-surgical treatment options"}], \
	    "surgery_purpose_necessity_effect": [{"title": "Laparoscopic cholecystectomy indications", "url": "https://www.sages.org/cholecystectomy-guidelines", "text": "Laparoscopic cholecystectomy indications"}], \
	    "surgery_method_content": { \
	      "overall_description": [{"title": "Laparoscopic cholecystectomy technique", "url": "https://www.uptodate.com/contents/laparoscopic-cholecystectomy", "text": "Laparoscopic cholecystectomy technique"}], \
	      "estimated_duration": [{"title": "Operative time factors", "url": "https://www.annalsofsurgery.com/operative-time", "text": "Operative time factors"}], \
	      "method_change_or_addition": [{"title": "Conversion to open surgery", "url": "https://www.worldjournalofsurgery.com/conversion", "text": "Conversion to open surgery"}], \
	      "transfusion_possibility": [{"title": "Blood transfusion guidelines", "url": "https://www.transfusion-medicine.com/elective-surgery", "text": "Blood transfusion guidelines"}], \
	      "surgeon_change_possibility": [{"title": "Surgical team management", "url": "https://www.patient-safety.org/team-management", "text": "Surgical team management"}] \
	    }, \
	    "possible_complications_sequelae": [{"title": "Surgical complications", "url": "https://www.surgical-endoscopy.com/complications", "text": "Surgical complications"}], \
	    "emergency_measures": [{"title": "Emergency procedures", "url": "https://www.emergency-surgery.org/protocols", "text": "Emergency procedures"}], \
	    "mortality_risk": [{"title": "Mortality statistics", "url": "https://www.meta-analysis.com/mortality", "text": "Mortality statistics"}] \
	  } \
	}' | curl -s -X POST http://localhost:8000/chat \
	     -H "Content-Type: application/json" \
	     -d @- | jq '.message, .is_content_modified'
	@echo ""
	@echo "=== 3ë‹¨ê³„: ì‰¬ìš´ ë§ë¡œ ë³€ê²½ ìš”ì²­ ==="
	@echo '{ \
	  "message": "ë” ì‰¬ìš´ ë§ë¡œ ë°”ê¿”ì£¼ì„¸ìš”.", \
	  "consents": { \
	    "prognosis_without_surgery": "ë‹´ë‚­ê²°ì„ì— ëŒ€í•´ ìˆ˜ìˆ ì„ ì‹œí–‰í•˜ì§€ ì•Šì„ ê²½ìš°, ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ì§€ì†ì ì¸ ë³µí†µê³¼ ì†Œí™”ë¶ˆëŸ‰ìœ¼ë¡œ ì¼ìƒìƒí™œì— í° ì§€ìž¥ì„ ë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë‹´ë‚­ë²½ì´ ë‘êº¼ì›Œì§€ê³  ìœ ì°©ì´ ì‹¬í•´ì ¸ ìˆ˜ìˆ ì´ ë”ìš± ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
	    "alternative_treatments": "ë‹´ë‚­ê²°ì„ ì¹˜ë£Œë¥¼ ìœ„í•œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” ì²´ì™¸ì¶©ê²©íŒŒì‡„ì„ìˆ (ESWL), ê²½êµ¬ ë‹´ì„ìš©í•´ì œ ë³µìš©, ê²½í”¼ì  ë‹´ë‚­ë°°ì•¡ìˆ  ë“±ì´ ìžˆìœ¼ë‚˜, ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ íš¨ê³¼ê°€ ì œí•œì ì´ê³  ìž¬ë°œë¥ ì´ ë†’ì•„ ê·¼ë³¸ì ì¸ ì¹˜ë£Œë²•ì¸ ìˆ˜ìˆ ì  ì¹˜ë£Œê°€ ê°€ìž¥ íš¨ê³¼ì ì¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìžˆìŠµë‹ˆë‹¤.", \
	    "surgery_purpose_necessity_effect": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì˜ ëª©ì ì€ ë‹´ë‚­ê²°ì„ìœ¼ë¡œ ì¸í•œ ì—¼ì¦ê³¼ í†µì¦ì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ê³ , ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì„ ì˜ˆë°©í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ìˆ˜ìˆ ì„ í†µí•´ í™˜ìžì˜ ì‚¶ì˜ ì§ˆì„ í¬ê²Œ ê°œì„ í•˜ê³  ì •ìƒì ì¸ ì¼ìƒìƒí™œë¡œì˜ ë³µê·€ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.", \
	    "surgery_method_content": { \
	      "overall_description": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ë°°ì— 3-4ê°œì˜ ìž‘ì€ êµ¬ë©(5-12mm)ì„ ëš«ì–´ ì¹´ë©”ë¼(ë³µê°•ê²½)ì™€ ìˆ˜ìˆ ê¸°êµ¬ë¥¼ ë„£ì–´ ë‹´ë‚­ì„ ì œê±°í•˜ëŠ” ìµœì†Œì¹¨ìŠµ ìˆ˜ìˆ ìž…ë‹ˆë‹¤. ì „ì‹ ë§ˆì·¨ í•˜ì— ì´ì‚°í™”íƒ„ì†Œ ê°€ìŠ¤ë¥¼ ë„£ì–´ ë³µê°•ì„ ë¶€í’€ë¦° í›„, ë‹´ë‚­ë™ë§¥ê³¼ ë‹´ë‚­ê´€ì„ ì°¾ì•„ ì•ˆì „í•˜ê²Œ ì ˆë‹¨í•˜ê³  ë‹´ë‚­ì„ ì™„ì „ížˆ ì œê±°í•©ë‹ˆë‹¤.", \
	      "estimated_duration": "ìˆ˜ìˆ  ì‹œê°„ì€ í™˜ìžì˜ ìƒíƒœì™€ ìˆ˜ìˆ ì˜ ë³µìž¡ì„±ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ 1-2ì‹œê°„ ì •ë„ ì†Œìš”ë˜ë©°, ìˆ˜ìˆ  ì „ ì¤€ë¹„ì‹œê°„ê³¼ ë§ˆì·¨ ì‹œê°„ì„ í¬í•¨í•˜ë©´ ì´ 3-4ì‹œê°„ ì •ë„ ì†Œìš”ë  ì˜ˆì •ìž…ë‹ˆë‹¤.", \
	      "method_change_or_addition": "ìˆ˜ìˆ  ì¤‘ ì‹¬í•œ ì—¼ì¦, ìœ ì°©, ì¶œí˜ˆ, í•´ë¶€í•™ì  ì´ìƒ ë“±ìœ¼ë¡œ ì¸í•´ ë³µê°•ê²½ ìˆ˜ìˆ ì´ ì–´ë ¤ìš¸ ê²½ìš° í™˜ìžì˜ ì•ˆì „ì„ ìœ„í•´ ê°œë³µìˆ˜ìˆ ë¡œ ì „í™˜í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ë‹´ê´€ì†ìƒì´ë‚˜ ê¸°íƒ€ í•©ë³‘ì¦ ë°œìƒ ì‹œ ì¶”ê°€ì ì¸ ìˆ˜ìˆ  ì ˆì°¨ê°€ í•„ìš”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
	      "transfusion_possibility": "ì¼ë°˜ì ìœ¼ë¡œ ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì¶œí˜ˆì´ ì ì€ ìˆ˜ìˆ ì´ë¯€ë¡œ ìˆ˜í˜ˆì´ í•„ìš”í•œ ê²½ìš°ëŠ” ë“œë¬¼ì§€ë§Œ, ì˜ˆìƒì¹˜ ëª»í•œ ëŒ€ëŸ‰ì¶œí˜ˆì´ë‚˜ í™˜ìžì˜ ë¹ˆí˜ˆ ìƒíƒœì— ë”°ë¼ ìˆ˜í˜ˆì´ í•„ìš”í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ì ì ˆí•œ í˜ˆì•¡ì œì œë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.", \
	      "surgeon_change_possibility": "ìˆ˜ìˆ  ì¤‘ ì‘ê¸‰ìƒí™© ë°œìƒ, ì£¼ì¹˜ì˜ì˜ ì»¨ë””ì…˜ ë‚œì¡°, ë˜ëŠ” ê¸°íƒ€ ë¶ˆê°€í”¼í•œ ì‚¬ìœ ë¡œ ì¸í•´ ë‹¤ë¥¸ ìˆ™ë ¨ëœ ì™¸ê³¼ì˜ì‚¬ê°€ ìˆ˜ìˆ ì„ ëŒ€ì‹  ì§„í–‰í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ìˆ˜ìˆ ì˜ ì—°ì†ì„±ê³¼ ì•ˆì „ì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ ì¶©ë¶„í•œ ì¸ìˆ˜ì¸ê³„ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤." \
	    }, \
	    "possible_complications_sequelae": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ê³¼ ê´€ë ¨í•˜ì—¬ ë°œìƒ ê°€ëŠ¥í•œ í•©ë³‘ì¦ìœ¼ë¡œëŠ” ì¶œí˜ˆ, ê°ì—¼, ë‹´ê´€ì†ìƒ, ìž¥ê¸°ì†ìƒ, ë§ˆì·¨ ê´€ë ¨ í•©ë³‘ì¦ ë“±ì´ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ìˆ˜ìˆ  í›„ ì°½ìƒ ê°ì—¼, ë³µê°• ë‚´ ë†ì–‘ í˜•ì„±, ë‹´ì¦™ ëˆ„ì¶œ, ì¼ì‹œì  ì†Œí™”ë¶ˆëŸ‰ ë“±ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ë“œë¬¼ê²ŒëŠ” ìž¬ìˆ˜ìˆ ì´ í•„ìš”í•œ ê²½ìš°ë„ ìžˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ í•©ë³‘ì¦ì€ ì ì ˆí•œ ì¹˜ë£Œë¥¼ í†µí•´ íšŒë³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.", \
	    "emergency_measures": "ìˆ˜ìˆ  ì¤‘ ë˜ëŠ” ìˆ˜ìˆ  í›„ ì‘ê¸‰ìƒí™©(ëŒ€ëŸ‰ì¶œí˜ˆ, ìž¥ê¸°ì†ìƒ, ë‹´ì¦™ëˆ„ì¶œ, ê°ì—¼ ë“±) ë°œìƒ ì‹œ ì¦‰ì‹œ ì‘ê¸‰ì²˜ì¹˜ë¥¼ ì‹œí–‰í•˜ê³ , í•„ìš”ì— ë”°ë¼ ì¤‘í™˜ìžì‹¤ ìž…ì›, ìž¬ìˆ˜ìˆ , ì¸í„°ë²¤ì…˜ ì‹œìˆ , í•­ìƒì œ ì¹˜ë£Œ, ìˆ˜í˜ˆ ë“±ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê²Œ ë©ë‹ˆë‹¤. 24ì‹œê°„ ì˜ë£Œì§„ì´ ëŒ€ê¸°í•˜ì—¬ ëª¨ë“  ì‘ê¸‰ìƒí™©ì— ì‹ ì†í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìžˆëŠ” ì²´ê³„ë¥¼ ê°–ì¶”ê³  ìžˆìŠµë‹ˆë‹¤.", \
	    "mortality_risk": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì•ˆì „í•œ ìˆ˜ìˆ ë¡œ ì•Œë ¤ì ¸ ìžˆìœ¼ë‚˜, ëª¨ë“  ìˆ˜ìˆ ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë§¤ìš° ë“œë¬¼ê²Œ ì‚¬ë§ì˜ ìœ„í—˜ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì‚¬ë§ ìœ„í—˜ë„ëŠ” í™˜ìžì˜ ë‚˜ì´, ì „ì‹ ìƒíƒœ, ë™ë°˜ì§ˆí™˜, ìˆ˜ìˆ ì˜ ë³µìž¡ì„± ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•  ë•Œ 1% ë¯¸ë§Œìœ¼ë¡œ ì˜ˆìƒë˜ë©°, ë§ˆì·¨ ê´€ë ¨ ìœ„í—˜ë„ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. ëª¨ë“  ì•ˆì „ì¡°ì¹˜ë¥¼ í†µí•´ ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ìžˆìŠµë‹ˆë‹¤." \
	  }, \
	  "references": { \
	    "prognosis_without_surgery": [], \
	    "alternative_treatments": [], \
	    "surgery_purpose_necessity_effect": [], \
	    "surgery_method_content": { \
	      "overall_description": [], \
	      "estimated_duration": [], \
	      "method_change_or_addition": [], \
	      "transfusion_possibility": [], \
	      "surgeon_change_possibility": [] \
	    }, \
	    "possible_complications_sequelae": [], \
	    "emergency_measures": [], \
	    "mortality_risk": [] \
	  } \
	}' | \
	curl -X POST http://localhost:8000/chat \
	     -H "Content-Type: application/json" \
	     -d @-

test-consent:
	echo '\
{ \
  "surgery_name": "Cholelithiasis", \
  "registration_no": "123", \
  "patient_name": "ê¹€í™˜ìž", \
  "age": 45, \
  "gender": "M", \
  "scheduled_date": "2025-07-01", \
  "diagnosis": "Cholelithiasis", \
  "surgical_site_mark": "RUQ", \
  "participants": [ \
    { "name": "ë°•í˜„", "is_specialist": true, "department": "GS" } \
  ], \
  "patient_condition": "Stable", \
  "special_conditions": { \
    "past_history": false, \
    "diabetes": false, \
    "smoking": false, \
    "hypertension": false, \
    "allergy": false, \
    "cardiovascular": false, \
    "respiratory": false, \
    "coagulation": false, \
    "medications": false, \
    "renal": false, \
    "drug_abuse": false, \
    "other": null \
  }, \
  "possum_score": { \
    "mortality_risk": 0.22, \
    "morbidity_risk": 5.47 \
  } \
}' | \
	curl -X POST http://localhost:8000/consent \
	     -H "Content-Type: application/json" \
	     -d @-

test-transform:
	echo '\
{ \
  "consents": { \
    "prognosis_without_surgery": "Cholelithiasisì— ëŒ€í•´ ìˆ˜ìˆ ì„ ì‹œí–‰í•˜ì§€ ì•Šì„ ê²½ìš°, ì¦ìƒì´ ì§€ì†ë˜ê±°ë‚˜ ì•…í™”ë  ìˆ˜ ìžˆìœ¼ë©°, í•©ë³‘ì¦ì´ ë°œìƒí•  ìœ„í—˜ì´ ìžˆìŠµë‹ˆë‹¤. í™˜ìžì˜ í˜„ìž¬ ìƒíƒœ(Stable)ë¥¼ ê³ ë ¤í•  ë•Œ ì ì ˆí•œ ì¹˜ë£Œê°€ í•„ìš”í•©ë‹ˆë‹¤.", \
    "alternative_treatments": "Cholelithiasis ì¹˜ë£Œë¥¼ ìœ„í•œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” ì•½ë¬¼ì¹˜ë£Œ, ë¬¼ë¦¬ì¹˜ë£Œ, ë°©ì‚¬ì„ ì¹˜ë£Œ ë“±ì´ ìžˆìœ¼ë‚˜, í™˜ìžì˜ ìƒíƒœì™€ ì§„ë‹¨ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í–ˆì„ ë•Œ ìˆ˜ìˆ ì  ì¹˜ë£Œê°€ ê°€ìž¥ ì í•©í•œ ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.", \
    "surgery_purpose_necessity_effect": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì˜ ëª©ì ì€ ë‹´ë‚­ê²°ì„ìœ¼ë¡œ ì¸í•œ ì—¼ì¦ê³¼ í†µì¦ì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ê³ , ê¸‰ì„± ë‹´ë‚­ì—¼, ë‹´ê´€ì—¼, ì·Œìž¥ì—¼ ë“±ì˜ ì‹¬ê°í•œ í•©ë³‘ì¦ì„ ì˜ˆë°©í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ìˆ˜ìˆ ì„ í†µí•´ í™˜ìžì˜ ì‚¶ì˜ ì§ˆì„ í¬ê²Œ ê°œì„ í•˜ê³  ì •ìƒì ì¸ ì¼ìƒìƒí™œë¡œì˜ ë³µê·€ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.", \
    "surgery_method_content": { \
      "overall_description": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ë°°ì— ìž‘ì€ êµ¬ë©ì„ ëš«ì–´ ì¹´ë©”ë¼ì™€ ìˆ˜ìˆ ê¸°êµ¬ë¥¼ ë„£ì–´ ë‹´ë‚­ì„ ì œê±°í•˜ëŠ” ìµœì†Œì¹¨ìŠµ ìˆ˜ìˆ ìž…ë‹ˆë‹¤.", \
      "estimated_duration": "ìˆ˜ìˆ  ì‹œê°„ì€ í™˜ìžì˜ ìƒíƒœì™€ ìˆ˜ìˆ ì˜ ë³µìž¡ì„±ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ 1-2ì‹œê°„ ì •ë„ ì†Œìš”ë˜ë©°, ìˆ˜ìˆ  ì „ ì¤€ë¹„ì‹œê°„ê³¼ ë§ˆì·¨ ì‹œê°„ì„ í¬í•¨í•˜ë©´ ì´ 3-4ì‹œê°„ ì •ë„ ì†Œìš”ë  ì˜ˆì •ìž…ë‹ˆë‹¤.", \
      "method_change_or_addition": "ìˆ˜ìˆ  ì¤‘ ì‹¬í•œ ì—¼ì¦, ìœ ì°©, ì¶œí˜ˆ, í•´ë¶€í•™ì  ì´ìƒ ë“±ìœ¼ë¡œ ì¸í•´ ë³µê°•ê²½ ìˆ˜ìˆ ì´ ì–´ë ¤ìš¸ ê²½ìš° í™˜ìžì˜ ì•ˆì „ì„ ìœ„í•´ ê°œë³µìˆ˜ìˆ ë¡œ ì „í™˜í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ë‹´ê´€ì†ìƒì´ë‚˜ ê¸°íƒ€ í•©ë³‘ì¦ ë°œìƒ ì‹œ ì¶”ê°€ì ì¸ ìˆ˜ìˆ  ì ˆì°¨ê°€ í•„ìš”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.", \
      "transfusion_possibility": "ì¼ë°˜ì ìœ¼ë¡œ ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì¶œí˜ˆì´ ì ì€ ìˆ˜ìˆ ì´ë¯€ë¡œ ìˆ˜í˜ˆì´ í•„ìš”í•œ ê²½ìš°ëŠ” ë“œë¬¼ì§€ë§Œ, ì˜ˆìƒì¹˜ ëª»í•œ ëŒ€ëŸ‰ì¶œí˜ˆì´ë‚˜ í™˜ìžì˜ ë¹ˆí˜ˆ ìƒíƒœì— ë”°ë¼ ìˆ˜í˜ˆì´ í•„ìš”í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ì ì ˆí•œ í˜ˆì•¡ì œì œë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.", \
      "surgeon_change_possibility": "ìˆ˜ìˆ  ì¤‘ ì‘ê¸‰ìƒí™© ë°œìƒ, ì£¼ì¹˜ì˜ì˜ ì»¨ë””ì…˜ ë‚œì¡°, ë˜ëŠ” ê¸°íƒ€ ë¶ˆê°€í”¼í•œ ì‚¬ìœ ë¡œ ì¸í•´ ë‹¤ë¥¸ ìˆ™ë ¨ëœ ì™¸ê³¼ì˜ì‚¬ê°€ ìˆ˜ìˆ ì„ ëŒ€ì‹  ì§„í–‰í•  ìˆ˜ ìžˆìœ¼ë©°, ì´ ê²½ìš° ìˆ˜ìˆ ì˜ ì—°ì†ì„±ê³¼ ì•ˆì „ì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ ì¶©ë¶„í•œ ì¸ìˆ˜ì¸ê³„ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤." \
    }, \
    "possible_complications_sequelae": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ê³¼ ê´€ë ¨í•˜ì—¬ ë°œìƒ ê°€ëŠ¥í•œ í•©ë³‘ì¦ìœ¼ë¡œëŠ” ì¶œí˜ˆ, ê°ì—¼, ë‹´ê´€ì†ìƒ, ìž¥ê¸°ì†ìƒ, ë§ˆì·¨ ê´€ë ¨ í•©ë³‘ì¦ ë“±ì´ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ ìˆ˜ìˆ  í›„ ì°½ìƒ ê°ì—¼, ë³µê°• ë‚´ ë†ì–‘ í˜•ì„±, ë‹´ì¦™ ëˆ„ì¶œ, ì¼ì‹œì  ì†Œí™”ë¶ˆëŸ‰ ë“±ì´ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë©°, ë“œë¬¼ê²ŒëŠ” ìž¬ìˆ˜ìˆ ì´ í•„ìš”í•œ ê²½ìš°ë„ ìžˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ í•©ë³‘ì¦ì€ ì ì ˆí•œ ì¹˜ë£Œë¥¼ í†µí•´ íšŒë³µ ê°€ëŠ¥í•©ë‹ˆë‹¤.", \
    "emergency_measures": "ìˆ˜ìˆ  ì¤‘ ë˜ëŠ” ìˆ˜ìˆ  í›„ ì‘ê¸‰ìƒí™©(ëŒ€ëŸ‰ì¶œí˜ˆ, ìž¥ê¸°ì†ìƒ, ë‹´ì¦™ëˆ„ì¶œ, ê°ì—¼ ë“±) ë°œìƒ ì‹œ ì¦‰ì‹œ ì‘ê¸‰ì²˜ì¹˜ë¥¼ ì‹œí–‰í•˜ê³ , í•„ìš”ì— ë”°ë¼ ì¤‘í™˜ìžì‹¤ ìž…ì›, ìž¬ìˆ˜ìˆ , ì¸í„°ë²¤ì…˜ ì‹œìˆ , í•­ìƒì œ ì¹˜ë£Œ, ìˆ˜í˜ˆ ë“±ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•˜ê²Œ ë©ë‹ˆë‹¤. 24ì‹œê°„ ì˜ë£Œì§„ì´ ëŒ€ê¸°í•˜ì—¬ ëª¨ë“  ì‘ê¸‰ìƒí™©ì— ì‹ ì†í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìžˆëŠ” ì²´ê³„ë¥¼ ê°–ì¶”ê³  ìžˆìŠµë‹ˆë‹¤.", \
    "mortality_risk": "ë³µê°•ê²½ ë‹´ë‚­ì ˆì œìˆ ì€ ì•ˆì „í•œ ìˆ˜ìˆ ë¡œ ì•Œë ¤ì ¸ ìžˆìœ¼ë‚˜, ëª¨ë“  ìˆ˜ìˆ ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë§¤ìš° ë“œë¬¼ê²Œ ì‚¬ë§ì˜ ìœ„í—˜ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì‚¬ë§ ìœ„í—˜ë„ëŠ” í™˜ìžì˜ ë‚˜ì´, ì „ì‹ ìƒíƒœ, ë™ë°˜ì§ˆí™˜, ìˆ˜ìˆ ì˜ ë³µìž¡ì„± ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•  ë•Œ 1% ë¯¸ë§Œìœ¼ë¡œ ì˜ˆìƒë˜ë©°, ë§ˆì·¨ ê´€ë ¨ ìœ„í—˜ë„ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. ëª¨ë“  ì•ˆì „ì¡°ì¹˜ë¥¼ í†µí•´ ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ìžˆìŠµë‹ˆë‹¤." \
  }, \
  "references": { \
    "prognosis_without_surgery": [], \
    "alternative_treatments": [], \
    "surgery_purpose_necessity_effect": [], \
    "surgery_method_content": { \
      "overall_description": [], \
      "estimated_duration": [], \
      "method_change_or_addition": [], \
      "transfusion_possibility": [], \
      "surgeon_change_possibility": [] \
    }, \
    "possible_complications_sequelae": [], \
    "emergency_measures": [], \
    "mortality_risk": [] \
  }, \
  "mode": "translate_en" \
}' | \
	curl -X POST http://localhost:8000/transform \
	     -H "Content-Type: application/json" \
	     -d @-

uptodate-crawl:
	poetry run python -m surgiform.core.ingest.uptodate.crawler

uptodate-crawl-cron:
	# ë§¤ì¼ ìƒˆë²½ 3ì‹œì— í¬ë¡¤ëŸ¬ ìž¬ì‹¤í–‰
	0 3 * * * \
		poetry run python -m surgiform.core.ingest.uptodate.crawler \
			>> ~/crawler.log 2>&1

neo4j-up:
	docker run -d --name neo4j \
		-e NEO4J_AUTH=neo4j/${NEO4J_PASSWORD} \
		-e NEO4J_PLUGINS='["apoc"]' \
		-e NEO4J_apoc_export_file_enabled=true \
		-e NEO4J_apoc_import_file_enabled=true \
		-e NEO4J_apoc_import_file_use__neo4j__config=true \
		-p 7687:7687 -p 7474:7474 \
		neo4j:5.26

neo4j-down:
	docker rm -f neo4j

neo4j-reset:
	make neo4j-down
	make neo4j-up

neo4j-logs:
	docker logs -f neo4j

build-rag:
	poetry run python -m surgiform.core.ingest.uptodate.medical_graph_rag \
	    --directory data/uptodate/general-surgery

es-up:
	docker run -d --name es \
		-e "discovery.type=single-node" \
		-e "xpack.security.enabled=false" \
		-p 9200:9200 \
		docker.elastic.co/elasticsearch/elasticsearch:8.13.0

es-down:
	docker rm -f es

es-reset:
	make es-down
	make es-up


build-es:
	poetry run python -m surgiform.core.ingest.uptodate.fast_medical_rag \
		--directory data/uptodate/general-surgery \
		--workers 8 \
		--search

run-es:
	poetry run python -m surgiform.core.ingest.uptodate.run_es


# es-index-up:
# 	curl -X PUT localhost:9200/cost_effect \
# 		-H "Content-Type: application/json" -d @- <<'JSON'
# 		{
# 		"mappings": {
# 			"properties": {
# 			"text": {
# 				"type":            "text",
# 				"term_vector":     "with_positions_offsets"   // í•˜ì´ë¼ì´íŠ¸ìš©
# 			}
# 			}
# 		}
# 		}
# 		JSON